<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<title>æ–‡ä»¶æ¸…å•ç”Ÿæˆå™¨</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“</text></svg>">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  --primary: #667eea;
  --primary-dark: #5a6fd8;
  --secondary: #764ba2;
  --light: #f8f9ff;
  --dark: #333;
  --gray: #6c757d;
  --success: #28a745;
  --danger: #dc3545;
  --warning: #ffc107;
  --info: #17a2b8;
  --border-radius: 16px;
  --box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
  --transition: all 0.3s ease;
}

body {
  font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  color: var(--dark);
  line-height: 1.6;
}

.container {
  background: #fff;
  border-radius: var(--border-radius);
  box-shadow: var(--box-shadow);
  padding: 40px;
  max-width: 1000px;
  width: 100%;
  text-align: center;
  position: relative;
  overflow: hidden;
  animation: fadeIn 0.8s ease-out;
  backdrop-filter: blur(10px);
  background: rgba(255, 255, 255, 0.95);
}

.container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.header {
  margin-bottom: 30px;
  position: relative;
}

.header h1 {
  font-size: 38px;
  margin-bottom: 15px;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-weight: 800;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 15px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.header p {
  color: var(--gray);
  margin-bottom: 8px;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.select-area {
  border: 3px dashed #ddd;
  border-radius: var(--border-radius);
  padding: 50px 20px;
  margin-bottom: 30px;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
  background: var(--light);
  backdrop-filter: blur(5px);
}

.select-area:hover {
  border-color: var(--primary);
  background: rgba(102, 126, 234, 0.08);
  transform: translateY(-5px);
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);
}

.select-icon {
  font-size: 70px;
  color: #ddd;
  margin-bottom: 20px;
  transition: var(--transition);
  filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
}

.select-area:hover .select-icon {
  color: var(--primary);
  transform: scale(1.15);
}

.select-text {
  font-size: 22px;
  font-weight: 700;
  color: #555;
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.select-hint {
  color: #888;
  font-size: 15px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

#fileInput {
  display: none;
}

.stats-container {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
  gap: 15px;
}

.stat-card {
  flex: 1;
  background: var(--light);
  padding: 20px;
  border-radius: var(--border-radius);
  text-align: center;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
  transition: var(--transition);
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
}

.stat-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
}

.stat-icon {
  font-size: 28px;
  margin-bottom: 12px;
  color: var(--primary);
  background: rgba(102, 126, 234, 0.1);
  width: 60px;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.stat-value {
  font-size: 26px;
  font-weight: 800;
  color: var(--primary);
  margin-bottom: 5px;
}

.stat-label {
  font-size: 15px;
  color: var(--gray);
  font-weight: 600;
}

.file-filter {
  background: var(--light);
  padding: 25px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  text-align: left;
  display: none;
  animation: slideDown 0.5s ease-out;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
  backdrop-filter: blur(5px);
}

.file-filter.show {
  display: block;
}

.filter-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.filter-title {
  font-weight: 700;
  color: var(--dark);
  display: flex;
  align-items: center;
  gap: 12px;
  font-size: 18px;
}

.filter-actions {
  display: flex;
  gap: 12px;
}

.filter-actions button {
  padding: 8px 16px;
  border: 2px solid var(--primary);
  background: transparent;
  color: var(--primary);
  border-radius: 8px;
  cursor: pointer;
  transition: var(--transition);
  font-size: 14px;
  font-weight: 600;
}

.filter-actions button:hover {
  background: var(--primary);
  color: white;
  transform: translateY(-2px);
}

.filter-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
  max-height: 200px;
  overflow-y: auto;
  padding: 15px;
  border: 1px solid #eee;
  border-radius: 12px;
  background: white;
  box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
}

.filter-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px;
  border-radius: 8px;
  transition: var(--transition);
}

.filter-item:hover {
  background: rgba(102, 126, 234, 0.05);
}

.filter-item input {
  margin: 0;
  transform: scale(1.2);
}

.file-list {
  max-height: 400px;
  overflow-y: auto;
  border: 1px solid #eee;
  border-radius: var(--border-radius);
  padding: 25px;
  margin-bottom: 20px;
  background: var(--light);
  display: none;
  text-align: left;
  transition: var(--transition);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
  backdrop-filter: blur(5px);
}

.file-list.show {
  display: block;
  animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
  from { opacity: 0; max-height: 0; }
  to { opacity: 1; max-height: 400px; }
}

.file-list h3 {
  margin-bottom: 20px;
  color: var(--dark);
  text-align: center;
  border-bottom: 2px solid #eee;
  padding-bottom: 15px;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  font-size: 20px;
}

.file-item {
  padding: 15px 20px;
  margin-bottom: 10px;
  background: #fff;
  border-left: 5px solid var(--primary);
  border-radius: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
  transition: var(--transition);
  position: relative;
  overflow: hidden;
}

.file-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
  transform: translateX(-100%);
}

.file-item:hover {
  transform: translateX(8px);
  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
  border-left-color: var(--secondary);
}

.file-item:hover::before {
  transform: translateX(100%);
  transition: transform 0.6s;
}

.file-name {
  flex: 1;
  font-size: 15px;
  color: var(--dark);
  font-weight: 500;
}

.file-size {
  color: var(--gray);
  font-size: 14px;
  margin-left: 15px;
  font-weight: 600;
  background: rgba(108, 117, 125, 0.1);
  padding: 4px 10px;
  border-radius: 20px;
}

.btn-generate {
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  color: #fff;
  border: none;
  padding: 18px 45px;
  border-radius: 30px;
  font-size: 18px;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
  display: none;
  transition: var(--transition);
  font-weight: 700;
  margin-top: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  position: relative;
  overflow: hidden;
}

.btn-generate::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
  transition: left 0.5s;
}

.btn-generate:hover, .btn-generate:focus {
  transform: translateY(-5px);
  box-shadow: 0 12px 25px rgba(102, 126, 234, 0.5);
  background: linear-gradient(45deg, var(--primary-dark), var(--secondary));
}

.btn-generate:hover::before {
  left: 100%;
}

.btn-generate:active {
  transform: translateY(-2px);
}

.status {
  margin-top: 20px;
  padding: 18px;
  border-radius: var(--border-radius);
  font-size: 15px;
  display: none;
  animation: fadeIn 0.5s ease-out;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.5s, transform 0.5s;
  backdrop-filter: blur(5px);
  font-weight: 500;
}

.status.show {
  display: block;
  opacity: 1;
  transform: translateY(0);
}

.status.success {
  background: #d4edda;
  color: #155724;
  border: 2px solid #c3e6cb;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 4px 10px rgba(40, 167, 69, 0.2);
}

.status.error {
  background: #f8d7da;
  color: #721c24;
  border: 2px solid #f5c6cb;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 4px 10px rgba(220, 53, 69, 0.2);
}

.status.info {
  background: #d1ecf1;
  color: #0c5460;
  border: 2px solid #bee5eb;
  display: flex;
  align-items: center;
  gap: 12px;
  box-shadow: 0 4px 10px rgba(23, 162, 184, 0.2);
}

.folder-info {
  margin-top: 15px;
  padding: 18px;
  background: #e9ecef;
  border-radius: var(--border-radius);
  font-size: 15px;
  color: #495057;
  display: none;
  text-align: left;
  display: flex;
  align-items: center;
  gap: 12px;
  font-weight: 500;
  box-shadow: 0 4px 10px rgba(0,0,0,0.05);
}

.folder-info.show {
  display: flex;
  animation: fadeIn 0.5s ease-out;
}

.progress-bar {
  width: 100%;
  height: 10px;
  background-color: #e9ecef;
  border-radius: 5px;
  margin: 20px 0;
  overflow: hidden;
  display: none;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

.progress {
  height: 100%;
  background: linear-gradient(45deg, var(--primary), var(--secondary));
  width: 0%;
  transition: width 0.5s ease;
  border-radius: 5px;
}

.file-type {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  margin-left: 10px;
  background: #e9ecef;
  color: #495057;
  font-weight: 600;
}

/* é”®ç›˜å¯¼èˆªç„¦ç‚¹æ ·å¼ */
.select-area:focus, .btn-generate:focus {
  outline: 3px solid var(--primary);
  outline-offset: 3px;
}

/* æ»šåŠ¨æ¡æ ·å¼ */
.file-list::-webkit-scrollbar,
.filter-list::-webkit-scrollbar {
  width: 10px;
}

.file-list::-webkit-scrollbar-track,
.filter-list::-webkit-scrollbar-track {
  background: #f1f1f1;
  border-radius: 10px;
}

.file-list::-webkit-scrollbar-thumb,
.filter-list::-webkit-scrollbar-thumb {
  background: var(--primary);
  border-radius: 10px;
}

.file-list::-webkit-scrollbar-thumb:hover,
.filter-list::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}

/* é¡µè„šæ ·å¼ */
.footer {
  margin-top: 40px;
  padding-top: 25px;
  border-top: 2px solid #eee;
  font-size: 15px;
  color: var(--gray);
  text-align: center;
}

.footer-content {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.footer-info {
  display: flex;
  justify-content: center;
  gap: 25px;
  flex-wrap: wrap;
}

.footer-info div {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 15px;
  background: rgba(108, 117, 125, 0.08);
  border-radius: 20px;
  transition: var(--transition);
}

.footer-info div:hover {
  background: rgba(108, 117, 125, 0.15);
  transform: translateY(-2px);
}

.footer a {
  color: var(--primary);
  text-decoration: none;
  transition: var(--transition);
  font-weight: 600;
}

.footer a:hover {
  color: var(--secondary);
  text-decoration: underline;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
  .container {
    padding: 25px;
  }
  
  .header h1 {
    font-size: 30px;
  }
  
  .stats-container {
    flex-direction: column;
  }
  
  .select-area {
    padding: 35px 15px;
  }
  
  .filter-list {
    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  }
  
  .footer-info {
    flex-direction: column;
    gap: 12px;
  }
  
  .btn-generate {
    padding: 16px 35px;
    font-size: 16px;
  }
}

/* ç²’å­èƒŒæ™¯æ•ˆæœ */
.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  pointer-events: none;
}

.particle {
  position: absolute;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  animation: float 15s infinite linear;
}

@keyframes float {
  0% {
    transform: translateY(0) rotate(0deg);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  90% {
    opacity: 1;
  }
  100% {
    transform: translateY(-1000px) rotate(720deg);
    opacity: 0;
  }
}
</style>
</head>
<body>
<!-- ç²’å­èƒŒæ™¯ -->
<div class="particles" id="particles"></div>

<div class="container">
  <div class="header">
    <h1><i class="fas fa-folder-open"></i>æ–‡ä»¶æ¸…å•ç”Ÿæˆå™¨</h1>
    <p><i class="fas fa-info-circle"></i>ç‚¹å‡»ä¸‹æ–¹åŒºåŸŸé€‰æ‹©æ–‡ä»¶å¤¹</p>
    <p><i class="fas fa-filter"></i>ä»…æ˜¾ç¤ºæ ¹ç›®å½•æ–‡ä»¶ï¼Œæ”¯æŒæŒ‰æ–‡ä»¶ç±»å‹ç­›é€‰</p>
  </div>

  <div class="select-area" id="selectArea" tabindex="0">
    <div class="select-icon">ğŸ“‚</div>
    <div class="select-text"><i class="fas fa-mouse-pointer"></i>ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹</div>
    <div class="select-hint"><i class="fas fa-exclamation-circle"></i>ä»…ä¼šåˆ—å‡ºé€‰ä¸­ç›®å½•æ ¹å±‚æ–‡ä»¶ï¼Œä¸å«å­æ–‡ä»¶å¤¹</div>
  </div>
  <input type="file" id="fileInput" webkitdirectory directory multiple>

  <div class="stats-container" id="statsContainer" style="display: none;">
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-file"></i></div>
      <div class="stat-value" id="fileCount">0</div>
      <div class="stat-label">æ–‡ä»¶æ•°é‡</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-weight-hanging"></i></div>
      <div class="stat-value" id="totalSize">0 B</div>
      <div class="stat-label">æ€»å¤§å°</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon"><i class="fas fa-folder"></i></div>
      <div class="stat-value" id="folderName">-</div>
      <div class="stat-label">æ–‡ä»¶å¤¹åç§°</div>
    </div>
  </div>

  <div class="file-filter" id="fileFilter">
    <div class="filter-header">
      <div class="filter-title">
        <i class="fas fa-filter"></i>
        <span>æ–‡ä»¶ç±»å‹ç­›é€‰ (é€‰æ‹©è¦å¯¼å‡ºçš„æ–‡ä»¶ç±»å‹)</span>
      </div>
      <div class="filter-actions">
        <button id="selectAllTypes">å…¨é€‰</button>
        <button id="deselectAllTypes">å–æ¶ˆå…¨é€‰</button>
      </div>
    </div>
    <div class="filter-list" id="filterList"></div>
  </div>

  <div class="file-list" id="fileList">
    <h3><i class="fas fa-list"></i>æ–‡ä»¶æ¸…å•é¢„è§ˆ</h3>
    <div id="fileItems"></div>
  </div>
  
  <button class="btn-generate" id="btnGenerate" tabindex="0">
    <i class="fas fa-file-excel"></i>ç”ŸæˆExcelæ–‡ä»¶
  </button>
  
  <div class="status" id="status"></div>
  
  <div class="footer">
    <div class="footer-content">
      <div class="footer-info">
        <div><i class="fas fa-user"></i> ä½œè€…ï¼šæŠ€æœ¯å¼€å‘äºŒéƒ¨</div>
        <div><i class="fas fa-code-branch"></i> ç‰ˆæœ¬ï¼šV1.1.0</div>
        <div><i class="fas fa-calendar"></i> æ›´æ–°æ—¥æœŸï¼š2025å¹´10æœˆ</div>
      </div>
      <div class="footer-info">
        <div><i class="fab fa-github"></i> GitHubï¼š<a href="https://github.com/caifugao110/FileList_Generator" target="_blank">https://github.com/caifugao110/FileList_Generator</a></div>
      </div>
      <div class="footer-info">
        <div><i class="fas fa-info-circle"></i> åŠŸèƒ½è¯´æ˜ï¼šæœ¬å·¥å…·ç”¨äºå¿«é€Ÿç”Ÿæˆæ–‡ä»¶å¤¹å†…æ–‡ä»¶çš„è¯¦ç»†æ¸…å•ï¼Œæ”¯æŒæ–‡ä»¶ç±»å‹ç­›é€‰ï¼Œç”Ÿæˆç¬¦åˆè¦æ±‚çš„çš„Excelæ–‡ä»¶ã€‚</div>
      </div>
    </div>
  </div>
</div>

<script>
// åˆ›å»ºç²’å­èƒŒæ™¯
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const particleCount = 30;
  
  for (let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.classList.add('particle');
    
    const size = Math.random() * 20 + 5;
    const left = Math.random() * 100;
    const animationDuration = Math.random() * 20 + 10;
    const animationDelay = Math.random() * 5;
    
    particle.style.width = `${size}px`;
    particle.style.height = `${size}px`;
    particle.style.left = `${left}%`;
    particle.style.animationDuration = `${animationDuration}s`;
    particle.style.animationDelay = `${animationDelay}s`;
    
    particlesContainer.appendChild(particle);
  }
}

// è·å–DOMå…ƒç´ 
const selectArea = document.getElementById('selectArea');
const fileInput = document.getElementById('fileInput');
const fileList = document.getElementById('fileList');
const fileItems = document.getElementById('fileItems');
const btnGenerate = document.getElementById('btnGenerate');
const statusBox = document.getElementById('status');
const statsContainer = document.getElementById('statsContainer');
const fileCountElement = document.getElementById('fileCount');
const totalSizeElement = document.getElementById('totalSize');
const folderNameElement = document.getElementById('folderName');
const fileFilter = document.getElementById('fileFilter');
const filterList = document.getElementById('filterList');
const selectAllTypes = document.getElementById('selectAllTypes');
const deselectAllTypes = document.getElementById('deselectAllTypes');

// å…¨å±€å˜é‡
let selectedFiles = [];
let folderName = '';
let fileTypes = new Set();
let selectedFileTypes = new Set();

// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
  createParticles();
  showStatus('æ¬¢è¿ä½¿ç”¨æ–‡ä»¶æ¸…å•ç”Ÿæˆå™¨ï¼è¯·ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹æŒ‰é’®é€‰æ‹©æ–‡ä»¶å¤¹ã€‚', 'info');
  
  // è®¾ç½®é”®ç›˜å¯¼èˆª
  selectArea.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      fileInput.click();
    }
  });
  
  btnGenerate.addEventListener('keydown', function(e) {
    if (e.key === 'Enter') {
      e.preventDefault();
      generateExcel();
    }
  });
  
  // æ–‡ä»¶ç±»å‹ç­›é€‰äº‹ä»¶
  selectAllTypes.addEventListener('click', function() {
    document.querySelectorAll('.file-type-checkbox').forEach(checkbox => {
      checkbox.checked = true;
      selectedFileTypes.add(checkbox.value);
    });
    updateFileList();
  });
  
  deselectAllTypes.addEventListener('click', function() {
    document.querySelectorAll('.file-type-checkbox').forEach(checkbox => {
      checkbox.checked = false;
      selectedFileTypes.delete(checkbox.value);
    });
    updateFileList();
  });
});

// ç‚¹å‡»é€‰æ‹©æ–‡ä»¶å¤¹
selectArea.addEventListener('click', () => fileInput.click());

// æ–‡ä»¶é€‰æ‹©äº‹ä»¶
fileInput.addEventListener('change', e => {
  processFiles(Array.from(e.target.files));
});

// å¤„ç†æ–‡ä»¶
function processFiles(files) {
  // è¿‡æ»¤æ‰.dbæ–‡ä»¶å’Œéšè—æ–‡ä»¶
  selectedFiles = files.filter(f => {
    const fileName = f.name.toLowerCase();
    return !fileName.endsWith('.db') && !f.name.startsWith('.');
  });
  
  // åªä¿ç•™æ ¹ç›®å½•æ–‡ä»¶ï¼ˆwebkitRelativePath ä¸å« "/" æˆ–ä¸ºç©ºï¼‰
  selectedFiles = selectedFiles.filter(f => {
    const path = f.webkitRelativePath || '';
    return path.split('/').length === 2; // æ–‡ä»¶å¤¹å/æ–‡ä»¶å
  });
  
  selectedFiles.sort((a, b) => a.name.localeCompare(b.name, 'zh-CN'));
  
  if (selectedFiles.length === 0) {
    showStatus('æœªé€‰ä¸­ä»»ä½•æ–‡ä»¶', 'error');
    return;
  }
  
  // è·å–æ–‡ä»¶å¤¹å
  if (selectedFiles.length > 0 && selectedFiles[0].webkitRelativePath) {
    folderName = selectedFiles[0].webkitRelativePath.split('/')[0];
  }
  
  // æå–æ–‡ä»¶ç±»å‹
  extractFileTypes();
  
  displayList();
  updateStats();
  btnGenerate.style.display = 'flex';
  showStatus(`å·²æˆåŠŸåŠ è½½ ${selectedFiles.length} ä¸ªæ–‡ä»¶ï¼ŒåŒ…å« ${fileTypes.size} ç§æ–‡ä»¶ç±»å‹`, 'success');
  
  // å¹³æ»‘æ»šåŠ¨åˆ°æ–‡ä»¶åˆ—è¡¨
  setTimeout(() => {
    fileList.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 300);
}

// æå–æ–‡ä»¶ç±»å‹
function extractFileTypes() {
  fileTypes.clear();
  selectedFileTypes.clear();
  
  selectedFiles.forEach(file => {
    const fileName = file.name;
    const dotIndex = fileName.lastIndexOf('.');
    const fileType = dotIndex !== -1 ? fileName.substring(dotIndex + 1).toUpperCase() : 'æ— æ‰©å±•å';
    fileTypes.add(fileType);
    selectedFileTypes.add(fileType);
  });
  
  // æ›´æ–°æ–‡ä»¶ç±»å‹ç­›é€‰å™¨
  updateFileTypeFilter();
}

// æ›´æ–°æ–‡ä»¶ç±»å‹ç­›é€‰å™¨
function updateFileTypeFilter() {
  filterList.innerHTML = '';
  
  fileTypes.forEach(fileType => {
    const filterItem = document.createElement('div');
    filterItem.className = 'filter-item';
    
    const checkbox = document.createElement('input');
    checkbox.type = 'checkbox';
    checkbox.id = `type-${fileType}`;
    checkbox.className = 'file-type-checkbox';
    checkbox.value = fileType;
    checkbox.checked = true;
    
    checkbox.addEventListener('change', function() {
      if (this.checked) {
        selectedFileTypes.add(fileType);
      } else {
        selectedFileTypes.delete(fileType);
      }
      updateFileList();
    });
    
    const label = document.createElement('label');
    label.htmlFor = `type-${fileType}`;
    label.textContent = fileType;
    
    filterItem.appendChild(checkbox);
    filterItem.appendChild(label);
    filterList.appendChild(filterItem);
  });
  
  fileFilter.classList.add('show');
}

// æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
function updateFileList() {
  fileItems.innerHTML = '';
  
  const filteredFiles = selectedFiles.filter(file => {
    const fileName = file.name;
    const dotIndex = fileName.lastIndexOf('.');
    const fileType = dotIndex !== -1 ? fileName.substring(dotIndex + 1).toUpperCase() : 'æ— æ‰©å±•å';
    return selectedFileTypes.has(fileType);
  });
  
  filteredFiles.forEach((f, i) => {
    const div = document.createElement('div');
    div.className = 'file-item';
    
    const nameSpan = document.createElement('span');
    nameSpan.className = 'file-name';
    nameSpan.textContent = `${i + 1}. ${f.name}`;
    
    const sizeSpan = document.createElement('span');
    sizeSpan.className = 'file-size';
    sizeSpan.textContent = formatFileSize(f.size);
    
    div.appendChild(nameSpan);
    div.appendChild(sizeSpan);
    fileItems.appendChild(div);
  });
  
  fileCountElement.textContent = filteredFiles.length;
  
  if (filteredFiles.length === 0) {
    fileItems.innerHTML = '<div style="text-align: center; padding: 20px; color: #6c757d;">æ²¡æœ‰ç¬¦åˆç­›é€‰æ¡ä»¶çš„æ–‡ä»¶</div>';
  }
  
  fileList.classList.add('show');
}

// æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
function updateStats() {
  const fileCount = selectedFiles.length;
  const totalSize = selectedFiles.reduce((sum, file) => sum + file.size, 0);
  
  fileCountElement.textContent = fileCount;
  totalSizeElement.textContent = formatFileSize(totalSize);
  folderNameElement.textContent = folderName || 'æœªçŸ¥æ–‡ä»¶å¤¹';
  
  statsContainer.style.display = 'flex';
}

function displayList() {
  updateFileList();
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
  if (bytes === 0) return '0 B';
  const k = 1024;
  const sizes = ['B', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// ç”ŸæˆExcel
function generateExcel() {
  btnGenerate.style.display = 'none';
  
  // æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
  showStatus('<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨ç”ŸæˆExcelæ–‡ä»¶ï¼Œè¯·ç¨å€™...', 'info');
  
  setTimeout(() => {
    const filteredFiles = selectedFiles.filter(file => {
      const fileName = file.name;
      const dotIndex = fileName.lastIndexOf('.');
      const fileType = dotIndex !== -1 ? fileName.substring(dotIndex + 1).toUpperCase() : 'æ— æ‰©å±•å';
      return selectedFileTypes.has(fileType);
    });
    
    const html = genExcel(filteredFiles);
    downloadExcel(html);
    btnGenerate.style.display = 'flex';
    showStatus('<i class="fas fa-check-circle"></i> Excelæ–‡ä»¶å·²ç”Ÿæˆå¹¶å¼€å§‹ä¸‹è½½', 'success');
  }, 1000);
}

// ç»‘å®šç”ŸæˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
btnGenerate.addEventListener('click', generateExcel);

// ç”ŸæˆExcelå†…å®¹
function genExcel(files) {
  const totalSize = files.reduce((sum, file) => sum + file.size, 0);
  const fileExtensions = [...new Set(files.map(f => {
    const parts = f.name.split('.');
    return parts.length > 1 ? parts.pop().toUpperCase() : 'æ— æ‰©å±•å';
  }))];
  
  let h = '<meta charset="utf-8"><style>'
      + 'body { font-family: "Segoe UI", Arial, sans-serif; margin: 20px; color: #333; background: #f8f9fa; }'
      + 'h1 { text-align: center; color: #2c3e50; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 3px solid #3498db; font-size: 28px; font-weight: 700; }'
      + 'table { border-collapse: collapse; width: 100%; font-size: 14px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-radius: 10px; overflow: hidden; }'
      + 'th, td { border: 1px solid #e0e0e0; padding: 14px 16px; text-align: left; }'
      + 'th { background: linear-gradient(to bottom, #3498db, #2980b9); color: white; font-weight: 700; text-transform: uppercase; letter-spacing: 0.8px; font-size: 15px; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }'
      + 'tr:nth-child(even) { background: #f8f9fa; }'
      + 'tr:hover { background: #e8f4fd; }'
      + '.summary { background: white; padding: 25px; border-radius: 10px; margin-bottom: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); border-left: 5px solid #3498db; }'
      + '.summary p { margin: 10px 0; font-size: 15px; }'
      + '.summary strong { color: #2c3e50; }'
      + '.header-row { background: #2c3e50 !important; color: white; font-weight: bold; text-align: center; font-size: 18px; }'
      + '.file-type { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 11px; background: #e9ecef; color: #495057; font-weight: 600; }'
      + '.footer { text-align: center; margin-top: 30px; color: #7f8c8d; font-size: 13px; border-top: 1px solid #ecf0f1; padding-top: 20px; }'
      + '</style>';
  
  h += '<h1>ğŸ“ æ–‡ä»¶æ¸…å•</h1>';
  
  // æ‘˜è¦ä¿¡æ¯
  h += '<div class="summary">';
  h += '<p><strong>ğŸ“‚ æ–‡ä»¶å¤¹åç§°:</strong> ' + esc(folderName || 'æœªçŸ¥æ–‡ä»¶å¤¹') + '</p>';
  h += '<p><strong>ğŸ“… ç”Ÿæˆæ—¶é—´:</strong> ' + new Date().toLocaleString('zh-CN') + '</p>';
  h += '<p><strong>ğŸ“Š æ–‡ä»¶æ€»æ•°:</strong> ' + files.length + ' ä¸ªæ–‡ä»¶</p>';
  h += '<p><strong>ğŸ’¾ æ€»å¤§å°:</strong> ' + formatFileSize(totalSize) + '</p>';
  h += '<p><strong>ğŸ”§ åŒ…å«çš„æ–‡ä»¶ç±»å‹:</strong> ' + fileExtensions.join(', ') + '</p>';
  h += '<p><strong>ğŸ› ï¸ ç”Ÿæˆå·¥å…·:</strong> æ–‡ä»¶æ¸…å•ç”Ÿæˆå™¨ V1.1.0</p>';
  h += '</div>';
  
  // æ–‡ä»¶åˆ—è¡¨è¡¨æ ¼
  h += '<table>';
  h += '<tr class="header-row"><td colspan="5">ğŸ“‹ æ–‡ä»¶æ¸…å•</td></tr>';
  h += '<tr><th>#</th><th>ğŸ“„ æ–‡ä»¶å</th><th>ğŸ“ ä¸åŒ…å«åç¼€çš„æ–‡ä»¶å</th><th>ğŸ’¾ å¤§å°</th><th>ğŸ“… ä¿®æ”¹æ—¶é—´</th></tr>';
  
  files.forEach((f, i) => {
    const fileNameWithoutExt = f.name.replace(/\.[^/.]+$/, "");
    
    h += `<tr>
            <td>${i + 1}</td>
            <td>${esc(f.name)}</td>
            <td>${esc(fileNameWithoutExt)}</td>
            <td>${formatFileSize(f.size)}</td>
            <td>${new Date(f.lastModified).toLocaleString('zh-CN')}</td>
          </tr>`;
  });
  
  h += '</table>';
  
  // ç»Ÿè®¡ä¿¡æ¯è¡¨æ ¼
  h += '<table>';
  h += '<tr class="header-row"><td colspan="2">ğŸ“Š ç»Ÿè®¡ä¿¡æ¯</td></tr>';
  h += '<tr><th>ğŸ“ˆ é¡¹ç›®</th><th>ğŸ”¢ æ•°å€¼</th></tr>';
  h += `<tr><td>æ–‡ä»¶æ€»æ•°</td><td>${files.length} ä¸ªæ–‡ä»¶</td></tr>`;
  h += `<tr><td>æ€»å¤§å°</td><td>${formatFileSize(totalSize)}</td></tr>`;
  h += `<tr><td>å¹³å‡æ–‡ä»¶å¤§å°</td><td>${formatFileSize(totalSize / files.length)}</td></tr>`;
  h += `<tr><td>æ–‡ä»¶ç±»å‹æ•°é‡</td><td>${fileExtensions.length} ç§ç±»å‹</td></tr>`;
  h += '</table>';
  
  // é¡µè„š
  h += '<div class="footer">';
  h += '<p>ğŸ› ï¸ ç”Ÿæˆå·¥å…·ï¼šæ–‡ä»¶æ¸…å•ç”Ÿæˆå™¨ | ğŸ‘¨â€ğŸ’» ä½œè€…ï¼šæŠ€æœ¯å¼€å‘äºŒéƒ¨ | ğŸ”— GitHub: https://github.com/caifugao110/FileList_Generator</p>';
  h += '</div>';
  
  return h;
}

// HTMLè½¬ä¹‰
function esc(s) {
  return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
}

// ä¸‹è½½Excelæ–‡ä»¶
function downloadExcel(html) {
  const timestamp = new Date().toISOString().replace(/[-:]/g, '').split('.')[0];
  const blob = new Blob(['\ufeff' + html], {type: 'application/vnd.ms-excel;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `æ–‡ä»¶æ¸…å•_${folderName || 'æ–‡ä»¶å¤¹'}_${timestamp}.xls`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯
function showStatus(msg, type) {
  statusBox.innerHTML = msg;
  statusBox.className = 'status ' + type;
  
  // ä½¿ç”¨requestAnimationFrameç¡®ä¿æ ·å¼å˜åŒ–è¢«æµè§ˆå™¨è¯†åˆ«
  requestAnimationFrame(() => {
    statusBox.classList.add('show');
  });
  
  // 4ç§’åè‡ªåŠ¨éšè—ï¼Œä½†å¦‚æœæ˜¯é”™è¯¯ä¿¡æ¯åˆ™ä¿ç•™æ›´é•¿æ—¶é—´
  const timeout = type === 'error' ? 6000 : 4000;
  setTimeout(() => {
    statusBox.classList.remove('show');
    setTimeout(() => {
      statusBox.style.display = 'none';
    }, 500);
  }, timeout);
}
</script>
</body>
</html>